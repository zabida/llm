<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„é¡¹ç›®</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}" >
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body class="bg-light">
<header>
    <div class="header-content">
        <img src="{{ url_for('static', filename='Up-Pointing-Hand-Emoji.png') }}" alt="é¡¹ç›®å›¾æ ‡" class="project-icon">
        <h1>springé¡¹ç›®é…ç½®å·¥å…·ç®±</h1>
    </div>
</header>
<div class="container py-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else 'info' }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form id="configForm" method="post" action="{{ url_for('submit') }}">
        <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Git åœ°å€</label>
            <div class="col-sm-10">
                <input type="text" name="git_address" class="form-control" required>
            </div>
        </div>
        <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Token</label>
            <div class="col-sm-10">
                <input type="text" name="token" class="form-control" required>
            </div>
        </div>

        <div id="groupsContainer"></div>

        <button type="button" class="btn btn-primary btn-add-group" onclick="addGroup()">+ æ·»åŠ é…ç½®ç»„</button>

        <div class="mt-4">
            <button type="submit" class="btn btn-success">ç¡®å®š</button>
        </div>
    </form>
</div>

<!-- æ¨¡æ€æ¡†ï¼šè¾“å…¥ç»„å -->
<div class="modal fade" id="groupNameModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">è¾“å…¥é…ç½®ç»„åç§°</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input
                    type="text"
                    id="inputGroupName"
                    class="form-control"
                    placeholder="ä¾‹å¦‚ï¼šç”Ÿäº§ç¯å¢ƒã€æµ‹è¯•é›†ç¾¤"
                    autofocus
                >
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" onclick="confirmGroupName()">ç¡®å®š</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='bootstrap.bundle.min.js') }}"></script>
<script>
let groupCount = 0;

// æ‰“å¼€æ¨¡æ€æ¡†æ—¶ç»‘å®šé”®ç›˜äº‹ä»¶
document.getElementById('groupNameModal').addEventListener('shown.bs.modal', function () {
    const input = document.getElementById('inputGroupName');
    input.value = '';
    input.focus();

    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§ç›‘å¬å™¨ï¼ˆé¿å…é‡å¤ç»‘å®šï¼‰
    input.removeEventListener('keydown', handleGroupNameKeydown);
    input.addEventListener('keydown', handleGroupNameKeydown);
});

function handleGroupNameKeydown(e) {
    if (e.key === 'Enter') {
        confirmGroupName();
    } else if (e.key === 'Escape') {
        bootstrap.Modal.getInstance(document.getElementById('groupNameModal')).hide();
    }
}

function addGroup() {
    const modal = new bootstrap.Modal(document.getElementById('groupNameModal'));
    modal.show();
}

function confirmGroupName() {
    const groupName = document.getElementById('inputGroupName').value.trim();
    if (!groupName) {
        alert('ç»„åä¸èƒ½ä¸ºç©ºï¼');
        return;
    }

    groupCount++;
    const container = document.getElementById('groupsContainer');
    const groupId = 'group-' + groupCount;

    const div = document.createElement('div');
    div.id = groupId;
    div.className = 'group-section mb-4 p-3 border rounded';

    div.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-bold text-dark">${groupName}</span>
            <button type="button" class="btn btn-sm p-0 text-body-secondary delete-btn" onclick="deleteGroup('${groupId}')">
                ğŸ—‘ï¸
            </button>
        </div>
        <input type="hidden" name="group_name_${groupCount}" value="${groupName}">
        <!-- è¾“å…¥æ¡†å­—æ®µä¿æŒä¸å˜ -->
        <div class="row mb-2">
            <div class="col-md-6"><input type="text" name="appid_${groupCount}" class="form-control" placeholder="AppID" required></div>
            <div class="col-md-6"><input type="text" name="static_token_${groupCount}" class="form-control" placeholder="é™æ€token" required></div>
        </div>
        <div class="row mb-2">
            <div class="col-md-3"><input type="text" name="region_${groupCount}" class="form-control" placeholder="Region"></div>
            <div class="col-md-3"><input type="text" name="environ_${groupCount}" class="form-control" placeholder="Environ"></div>
            <div class="col-md-3"><input type="text" name="onekey_${groupCount}" class="form-control" placeholder="ä¸»æ ¹"></div>
            <div class="col-md-3"><input type="text" name="twokey_${groupCount}" class="form-control" placeholder="è¾…æ ¹"></div>
        </div>
        <div class="row">
            <div class="col-md-6"><input type="text" name="baseprofile_${groupCount}" class="form-control" placeholder="åŸºç¡€profileæ–‡ä»¶è·¯å¾„"></div>
            <div class="col-md-6"><input type="text" name="appendprofile_${groupCount}" class="form-control" placeholder="ç¯å¢ƒprofileæ–‡ä»¶è·¯å¾„"></div>
        </div>
    `;
    container.appendChild(div);
    bootstrap.Modal.getInstance(document.getElementById('groupNameModal')).hide();
}

function deleteGroup(groupId) {
    if (confirm('ç¡®å®šåˆ é™¤æ­¤é…ç½®ç»„ï¼Ÿ')) {
        document.getElementById(groupId)?.remove();
    }
}
</script>
</body>
</html>